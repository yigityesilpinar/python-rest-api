# load dotenv
if [ -f .env ]; then
  export $(echo $(cat .env | sed 's/#.*//g'| xargs) | envsubst)
fi

# cleanup
docker stop container-python-rest-api 2> /dev/null > /dev/null
docker rm container-python-rest-api 2> /dev/null > /dev/null
docker stop container-python-rest-api-email-queue-worker 2> /dev/null > /dev/null
docker rm container-python-rest-api-email-queue-worker 2> /dev/null > /dev/null

# run app
docker run -dp 5000:5000 -w /app -v "$(pwd):/app" --name container-python-rest-api python-rest-api:latest sh -c "flask run --host 0.0.0.0" 
# run email worker
docker run -d -w /app -v "$(pwd):/app" --name container-python-rest-api-email-queue-worker python-rest-api:latest sh -c "rq worker -u ${TASK_QUEUE_REDIS_URL} emails" 